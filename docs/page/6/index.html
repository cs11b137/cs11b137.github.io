<!DOCTYPE html>
<html lang="zh-cn">
    <head>
	<meta name="generator" content="Hugo 0.152.2"><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Saiga</title><meta name="Description" content="This is my cool site"><meta property="og:url" content="http://localhost:1313/">
  <meta property="og:site_name" content="Saiga">
  <meta property="og:title" content="Saiga">
  <meta property="og:description" content="This is my cool site">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="website">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Saiga">
  <meta name="twitter:description" content="This is my cool site">
      <meta name="twitter:site" content="@https://github.com/cs11b137">
<meta name="application-name" content="Saiga">
<meta name="apple-mobile-web-app-title" content="Saiga"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/logo.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://localhost:1313/" /><link rel="alternate" href="/index.xml" type="application/rss+xml" title="Saiga">
    <link rel="feed" href="/index.xml" type="application/rss+xml" title="Saiga"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "WebSite",
        "url": "http:\/\/localhost:1313\/","inLanguage": "zh-cn","author": {
                "@type": "Person",
                "name": "wuwj"
            },"description": "This is my cool site","name": "Saiga"
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Saiga">Saiga</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/"> About </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Saiga">Saiga</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="">About</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="page home" data-home="posts"><div class="home-profile"><div class="home-avatar"><a href="/posts/" title="Posts"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./avatar.jpg"
        data-srcset="./avatar.jpg, ./avatar.jpg 1.5x, ./avatar.jpg 2x"
        data-sizes="auto"
        alt="./avatar.jpg"
        title="./avatar.jpg" /></a></div><div class="home-subtitle"><div id="id-1" class="typeit"></div></div><div class="links"><a href="https://github.com/https://github.com/cs11b137" title="GitHub" target="_blank" rel="noopener noreffer me"><i class="fab fa-github fa-fw" aria-hidden="true"></i></a><a href="https://facebook.com/https://github.com/cs11b137" title="facebook" target="_blank" rel="noopener noreffer me"><i class="fab fa-facebook fa-fw" aria-hidden="true"></i></a><a href="mailto:https://github.com/cs11b137" title="Email" rel="me"><i class="far fa-envelope fa-fw" aria-hidden="true"></i></a><a href="https://github.com/cs11b137" target="_blank" rel="noopener noreffer me"></a><a href="https://linkedin.com/in/https://github.com/cs11b137" title="LinkedIn" target="_blank" rel="noopener noreffer me"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a><a href="https://twitter.com/https://github.com/cs11b137" title="Twitter" target="_blank" rel="noopener noreffer me"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="https://www.instagram.com/https://github.com/cs11b137" title="Instagram" target="_blank" rel="noopener noreffer me"><i class="fab fa-instagram fa-fw" aria-hidden="true"></i></a><a href="https://t.me/https://github.com/cs11b137" title="Telegram" target="_blank" rel="noopener noreffer me"><i class="fab fa-telegram-plane fa-fw" aria-hidden="true"></i></a><a href="https://www.youtube.com/user/https://github.com/cs11b137" title="YouTube" target="_blank" rel="noopener noreffer me"><i class="fab fa-youtube fa-fw" aria-hidden="true"></i></a><a href="/index.xml" title="RSS" target="_blank" rel="noopener noreffer me"><i class="fas fa-rss fa-fw" aria-hidden="true"></i></a></div></div>
<article class="single summary" itemscope itemtype="http://schema.org/Article"><h1 class="single-title" itemprop="name headline">
        <a href="/posts/2021-12-05-first-ai-touch/">用云端 NLP API 做一个简单的文本分析工具</a>
    </h1><div class="post-meta"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>wuwj</a></span>&nbsp;<span class="post-publish">发布于 <time datetime="2021-12-05">2021-12-05</time></span>&nbsp;<span class="post-category">收录于 <a href="/categories/ai-%E6%8E%A2%E7%B4%A2/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>AI 探索</a></span></div><div class="content"><p>很早之前就对「AI 能不能帮忙看评论、看工单」这件事好奇过，但自己训模型门槛挺高，于是先选了条<strong>最省事的路</strong>：</p>
<blockquote>
<p>找一个云厂商提供的 NLP API，用 HTTP 请求的方式做一层简单封装，做一个「文本分析小工具」。</p>
</blockquote>
<p>这篇文章记录的是那次尝试的过程。</p>
<blockquote>
<p>注：下面不强调具体厂商名字，主线思路在于「怎么用」，而不是「用谁」。</p>
</blockquote>
<hr>
<h2 id="1-想做一个什么样的小工具">1. 想做一个什么样的小工具？</h2>
<p>需求非常朴素：</p>
<ul>
<li>输入一段文本（比如用户评论、客服工单）；</li>
<li>自动判断它是「正向 / 负向 / 中性」；</li>
<li>选做：给出一个大致类别，比如「产品问题 / 物流问题 / 售后问题」。</li>
</ul>
<p>最终希望变成一个简单的 Web 页面：</p>
<ul>
<li>左边输入框；</li>
<li>右边展示：情感结果、类别标签、关键句/关键词。</li>
</ul>
<hr>
<h2 id="2-挑选一个云-nlp-服务">2. 挑选一个云 NLP 服务</h2>
<p>大部分云厂商都会提供类似能力：</p>
<ul>
<li>情感分析（Sentiment Analysis）；</li>
<li>文本分类（Text Classification）；</li>
<li>关键词提取、实体识别等。</li>
</ul>
<p>通常接入步骤类似：</p>
<ol>
<li>注册账号；</li>
<li>在控制台创建一个 NLP 应用 / 项目；</li>
<li>拿到 API Key / Secret / Endpoint；</li>
<li>看一眼文档里示例请求。</li>
</ol>
<p>示例请求（伪代码）：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">POST /nlp/sentiment
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">Authorization: Bearer &lt;API_KEY&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">Content-Type: application/json
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">{
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">  &#34;text&#34;: &#34;这次发货太慢了，等了一个星期才收到。&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}
</span></span></span></code></pre></div><p>响应大概会是：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;sentiment&#34;</span>: <span style="color:#e6db74">&#34;negative&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;confidence&#34;</span>: <span style="color:#ae81ff">0.94</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>或者更细一些：</p></div><div class="post-footer">
        <a href="/posts/2021-12-05-first-ai-touch/">阅读全文</a><div class="post-tags">
                <i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/nlp/">NLP</a>,&nbsp;<a href="/tags/%E6%96%87%E6%9C%AC%E5%88%86%E6%9E%90/">文本分析</a>,&nbsp;<a href="/tags/%E4%BA%91%E6%9C%8D%E5%8A%A1/">云服务</a></div></div>
</article><article class="single summary" itemscope itemtype="http://schema.org/Article"><h1 class="single-title" itemprop="name headline">
        <a href="/posts/2021-10-20-ci-cd-for-frontend/">给前端项目接上 CI/CD：自动构建与预发布环境</a>
    </h1><div class="post-meta"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>wuwj</a></span>&nbsp;<span class="post-publish">发布于 <time datetime="2021-10-20">2021-10-20</time></span>&nbsp;<span class="post-category">收录于 <a href="/categories/%E5%B7%A5%E7%A8%8B%E5%8C%96/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>工程化</a></span></div><div class="content"><p>以前做前端上线，经常是这样的：</p>
<ul>
<li>本地 <code>npm run build</code> 打包；</li>
<li>用 FTP 或手动拷贝把 dist 丢到服务器；</li>
<li>出了问题再手动覆盖回去。</li>
</ul>
<p>这种方式有几个明显缺点：</p>
<ul>
<li>完全依赖人的操作习惯，出错难追踪；</li>
<li>没有固定的「预发布环境」，测试体验不好；</li>
<li>回滚麻烦，基本靠「手快」。</li>
</ul>
<p>这篇文章记录的是：<strong>一次给前端项目接上 CI/CD 的实际过程</strong>，目标是：</p>
<blockquote>
<p>提交代码 → 自动构建 → 部署到预发布 → 人工验证 → 一键上线 &amp; 可快速回滚。</p>
</blockquote>
<hr>
<h2 id="1-流程目标先画出来">1. 流程目标先画出来</h2>
<p>先不管用什么平台（GitHub Actions、GitLab CI、Jenkins…），流程大致分为几步：</p>
<ol>
<li>
<p><strong>CI 阶段（持续集成）</strong></p>
<ul>
<li>安装依赖；</li>
<li>跑 lint / 单测；</li>
<li>打包构建。</li>
</ul>
</li>
<li>
<p><strong>CD 阶段（持续交付/部署）</strong></p>
<ul>
<li>构建产物上传到制品库或对象存储；</li>
<li>自动部署到预发布环境；</li>
<li>人工验证无问题后，再部署到生产；</li>
<li>所有版本有记录，可一键回滚。</li>
</ul>
</li>
</ol>
<p>把这张「大图」先画给团队看，大家对齐预期后，再来谈具体实现。</p>
<hr>
<h2 id="2-以-github-actions-为例写一个最小流水线">2. 以 GitHub Actions 为例写一个最小流水线</h2>
<h3 id="21-基础-ci安装--构建">2.1 基础 CI：安装 + 构建</h3>
<p><code>.github/workflows/ci.yml</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">Frontend CI</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">on</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">pull_request</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">branches</span>: [ <span style="color:#ae81ff">main, develop ]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">push</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">branches</span>: [ <span style="color:#ae81ff">develop ]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">jobs</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Checkout code</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Use Node.js</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/setup-node@v3</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">node-version</span>: <span style="color:#e6db74">&#39;18&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Install dependencies</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: <span style="color:#ae81ff">npm ci</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Lint</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: <span style="color:#ae81ff">npm run lint</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Build</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: <span style="color:#ae81ff">npm run build</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Archive production artifacts</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/upload-artifact@v3</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">dist</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">path</span>: <span style="color:#ae81ff">dist</span>
</span></span></code></pre></div><p>这样每次 PR / 推送到 develop，都能自动帮你检查：</p></div><div class="post-footer">
        <a href="/posts/2021-10-20-ci-cd-for-frontend/">阅读全文</a><div class="post-tags">
                <i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/ci/cd/">CI/CD</a>,&nbsp;<a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/">自动化部署</a>,&nbsp;<a href="/tags/%E5%89%8D%E7%AB%AF%E5%8F%91%E5%B8%83%E6%B5%81%E7%A8%8B/">前端发布流程</a></div></div>
</article><article class="single summary" itemscope itemtype="http://schema.org/Article"><h1 class="single-title" itemprop="name headline">
        <a href="/posts/2021-08-30-api-contract-and-mock/">前后端协作改造记：从「口头协议」到 Mock 驱动开发</a>
    </h1><div class="post-meta"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>wuwj</a></span>&nbsp;<span class="post-publish">发布于 <time datetime="2021-08-30">2021-08-30</time></span>&nbsp;<span class="post-category">收录于 <a href="/categories/%E5%B7%A5%E7%A8%8B%E5%8D%8F%E4%BD%9C/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>工程协作</a></span></div><div class="content"><p>很多项目的前后端协作，一开始都是这样：</p>
<blockquote>
<p>「你先把页面搭着，接口我晚点给你。」<br>
「返回字段大概就这些，不行再改。」</p>
</blockquote>
<p>结果就是：</p>
<ul>
<li>接口文档滞后甚至缺失，全靠口头约定；</li>
<li>字段今天叫 <code>userName</code> 明天叫 <code>customerName</code>；</li>
<li>前端经常等后端联调，后端也抱怨前端改来改去。</li>
</ul>
<p>这篇文章是一次真实改造的复盘：我们从这种「口头协议」状态，逐步过渡到：</p>
<blockquote>
<p>有规范的接口文档 + 可用的 Mock 服务 + 基于契约的联调流程。</p>
</blockquote>
<hr>
<h2 id="1-先承认问题我们缺的不是工具而是契约">1. 先承认问题：我们缺的不是工具，而是「契约」</h2>
<p>一开始我们也装过各种工具：</p>
<ul>
<li>Swagger / OpenAPI；</li>
<li>YApi / Rap2 之类的平台；</li>
<li>各种 Mock 插件。</li>
</ul>
<p>但用一段时间就废掉了，根本原因是：<strong>文档没人维护，接口变更不走流程</strong>。</p>
<p>所以改造的第一步，不是换工具，而是统一几个规则：</p>
<ol>
<li><strong>所有新接口必须先有文档，再开发</strong>；</li>
<li>文档就是契约：前端后端都按契约来实现；</li>
<li>接口变更要么走版本，要么走兼容字段，不再「直接改」。</li>
</ol>
<p>工具只是为了让这套流程变得没那么痛苦。</p>
<hr>
<h2 id="2-选择和收敛接口文档工具">2. 选择和收敛接口文档工具</h2>
<p>我们最终选的是：<strong>OpenAPI 规格 + 一套接口管理平台（如 YApi 或内部平台）</strong>：</p>
<ul>
<li>提供可视化的接口列表、请求例子、响应示例；</li>
<li>支持一键导出 JSON / SDK 生成；</li>
<li>自带 Mock 功能。</li>
</ul>
<p>接口粒度大致是：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">paths</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">/api/order/list</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">post</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">summary</span>: <span style="color:#ae81ff">订单列表</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">parameters</span>: []
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">requestBody</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">content</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">application/json</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">schema</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">$ref</span>: <span style="color:#e6db74">&#39;#/components/schemas/OrderListRequest&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">responses</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#39;200&#39;</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">description</span>: <span style="color:#ae81ff">OK</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">content</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">application/json</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">schema</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">$ref</span>: <span style="color:#e6db74">&#39;#/components/schemas/OrderListResponse&#39;</span>
</span></span></code></pre></div><p>当后端定义好这些 schema 后，前端就可以基于文档做代码生成、Mock 数据、类型定义。</p></div><div class="post-footer">
        <a href="/posts/2021-08-30-api-contract-and-mock/">阅读全文</a><div class="post-tags">
                <i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/%E6%8E%A5%E5%8F%A3%E8%A7%84%E8%8C%83/">接口规范</a>,&nbsp;<a href="/tags/mock/">Mock</a>,&nbsp;<a href="/tags/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%8D%8F%E4%BD%9C/">前后端协作</a></div></div>
</article><article class="single summary" itemscope itemtype="http://schema.org/Article"><h1 class="single-title" itemprop="name headline">
        <a href="/posts/2021-06-15-config-driven-page/">配置驱动页面：表单、表格到「低代码」的第一步</a>
    </h1><div class="post-meta"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>wuwj</a></span>&nbsp;<span class="post-publish">发布于 <time datetime="2021-06-15">2021-06-15</time></span>&nbsp;<span class="post-category">收录于 <a href="/categories/%E9%85%8D%E7%BD%AE%E5%8C%96%E4%B8%8E%E4%BD%8E%E4%BB%A3%E7%A0%81/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>配置化与低代码</a></span></div><div class="content"><p>在中后台项目里，经常会出现这样的需求：</p>
<ul>
<li>一堆「结构相似、字段不同」的表单；</li>
<li>一堆「上面查询、下面表格」的列表页。</li>
</ul>
<p>如果每个页面都手写一次：表单 + 校验 + 表格列 + 操作按钮，不仅枯燥，还很难保持统一风格。</p>
<p>这篇文章讲的是我在项目里做的一次尝试：</p>
<blockquote>
<p><strong>用一份 JSON 配置描述页面，再写一个「解释器组件」负责渲染表单和表格。</strong><br>
这是往低代码方向迈出的第一小步。</p>
</blockquote>
<hr>
<h2 id="1-先从配置表单开始">1. 先从「配置表单」开始</h2>
<p>以一个常见的查询表单为例，我们希望用一份配置来描述：</p>
<ul>
<li>有哪些字段；</li>
<li>每个字段是什么类型（输入框、下拉、日期范围等）；</li>
<li>默认值、占位文案、选项等等。</li>
</ul>
<h3 id="11-配置结构示例">1.1 配置结构示例</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#75715e">// types.ts
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">FieldType</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;input&#39;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&#39;select&#39;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&#39;daterange&#39;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&#39;switch&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">FormField</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">prop</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">label</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">FieldType</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">placeholder?</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">options?</span>: <span style="color:#66d9ef">Array</span><span style="color:#f92672">&lt;</span>{ <span style="color:#a6e22e">label</span>: <span style="color:#66d9ef">string</span>; <span style="color:#a6e22e">value</span>: <span style="color:#66d9ef">string</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">number</span> }<span style="color:#f92672">&gt;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">span?</span>: <span style="color:#66d9ef">number</span>; <span style="color:#75715e">// 栅格宽度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">required?</span>: <span style="color:#66d9ef">boolean</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>某个页面里的配置：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#75715e">// orderListPageConfig.ts
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">searchFields</span>: <span style="color:#66d9ef">FormField</span>[] <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">prop</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;keyword&#39;</span>, <span style="color:#a6e22e">label</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;关键词&#39;</span>, <span style="color:#66d9ef">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;input&#39;</span>, <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;订单号/客户名&#39;</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">prop</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;status&#39;</span>, <span style="color:#a6e22e">label</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;状态&#39;</span>, <span style="color:#66d9ef">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;select&#39;</span>, <span style="color:#a6e22e">options</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    { <span style="color:#a6e22e">label</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;全部&#39;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span> },
</span></span><span style="display:flex;"><span>    { <span style="color:#a6e22e">label</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;待支付&#39;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;PENDING&#39;</span> },
</span></span><span style="display:flex;"><span>    { <span style="color:#a6e22e">label</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;已支付&#39;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;PAID&#39;</span> },
</span></span><span style="display:flex;"><span>  ]},
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">prop</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;dateRange&#39;</span>, <span style="color:#a6e22e">label</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;创建时间&#39;</span>, <span style="color:#66d9ef">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;daterange&#39;</span> },
</span></span><span style="display:flex;"><span>];
</span></span></code></pre></div><h3 id="12-通用-formrenderer-组件">1.2 通用 FormRenderer 组件</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vue" data-lang="vue"><span style="display:flex;"><span><span style="color:#75715e">&lt;!--</span> <span style="color:#a6e22e">FormRenderer</span>.<span style="color:#a6e22e">vue</span><span style="color:#960050;background-color:#1e0010">（</span><span style="color:#a6e22e">示意</span><span style="color:#960050;background-color:#1e0010">）</span> <span style="color:#f92672">--&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">template</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">el-form</span> <span style="color:#f92672">:model</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;model&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;config-form&#34;</span> <span style="color:#a6e22e">label</span><span style="color:#f92672">-width</span><span style="color:#960050;background-color:#1e0010">=&#34;</span><span style="color:#a6e22e">90px</span><span style="color:#960050;background-color:#1e0010">&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">el-row</span> <span style="color:#f92672">:gutter</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;16&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">el-col</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">v-for</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;field in fields&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">:key</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;field.prop&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">:</span><span style="color:#a6e22e">span</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;field.span || 8&#34;</span>
</span></span><span style="display:flex;"><span>      &gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">el-form-item</span> <span style="color:#f92672">:label</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;field.label&#34;</span> <span style="color:#f92672">:prop</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;field.prop&#34;</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="color:#f92672">component</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">:is</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;getComponent(field)&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">v-model</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;model[field.prop]&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">v-bind</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;getComponentProps(field)&#34;</span>
</span></span><span style="display:flex;"><span>          /&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">el-form-item</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#f92672">el-col</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">el-row</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">el-form-item</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">el-button</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;primary&#34;</span> <span style="color:#f92672">@click</span><span style="color:#e6db74">=&#34;$emit(&#39;search&#39;, model)&#34;</span>&gt;<span style="color:#a6e22e">查询</span><span style="color:#960050;background-color:#1e0010">&lt;/</span><span style="color:#a6e22e">el</span><span style="color:#f92672">-button</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">el-button</span> <span style="color:#f92672">@click</span><span style="color:#e6db74">=&#34;onReset&#34;</span>&gt;<span style="color:#a6e22e">重置</span><span style="color:#960050;background-color:#1e0010">&lt;/</span><span style="color:#a6e22e">el</span><span style="color:#f92672">-button</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">el-form-item</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">el-form</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">template</span>&gt;
</span></span></code></pre></div><p><code>getComponent</code> 根据类型返回不同组件：</p></div><div class="post-footer">
        <a href="/posts/2021-06-15-config-driven-page/">阅读全文</a><div class="post-tags">
                <i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/%E9%85%8D%E7%BD%AE%E9%A9%B1%E5%8A%A8/">配置驱动</a>,&nbsp;<a href="/tags/%E8%A1%A8%E5%8D%95/">表单</a>,&nbsp;<a href="/tags/%E8%A1%A8%E6%A0%BC/">表格</a>,&nbsp;<a href="/tags/%E4%BD%8E%E4%BB%A3%E7%A0%81/">低代码</a></div></div>
</article><article class="single summary" itemscope itemtype="http://schema.org/Article"><h1 class="single-title" itemprop="name headline">
        <a href="/posts/2021-04-02-permission-system-design/">菜单、按钮、接口：一套权限系统怎么落地到前端</a>
    </h1><div class="post-meta"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>wuwj</a></span>&nbsp;<span class="post-publish">发布于 <time datetime="2021-04-02">2021-04-02</time></span>&nbsp;<span class="post-category">收录于 <a href="/categories/%E4%B8%AD%E5%90%8E%E5%8F%B0%E6%9E%B6%E6%9E%84/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>中后台架构</a></span></div><div class="content"><p>中后台项目到了一定体量之后，绕不开一个问题：<strong>权限怎么做？</strong></p>
<ul>
<li>不同角色看到的菜单不一样；</li>
<li>同一个页面里，有人能点「导出」、有人只能看；</li>
<li>接口层还要做真正的权限校验。</li>
</ul>
<p>这篇文章从实践角度，串一下我现在常用的一套设计：从「角色-权限-资源」模型，到前端路由、按钮显隐，再到接口鉴权。</p>
<hr>
<h2 id="1-模型角色权限点资源">1. 模型：角色、权限点、资源</h2>
<p>先把概念讲清楚：</p>
<ul>
<li><strong>用户（User）</strong>：具体的人；</li>
<li><strong>角色（Role）</strong>：一类权限集合，例如「运营」、「风控」、「管理员」；</li>
<li><strong>权限点（Permission）</strong>：最小粒度的能力，比如「订单列表查看」「订单导出」；</li>
<li><strong>资源（Resource）</strong>：被操作的对象，比如菜单、按钮、接口。</li>
</ul>
<p>关系一般是：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>User → 多个 Role → 多个 Permission → 作用在不同 Resource 上
</span></span></code></pre></div><p>前端最关心的其实只有一件事：</p>
<blockquote>
<p>登录之后，我拿到的「权限点列表」是什么？</p>
</blockquote>
<p>因为<strong>菜单、按钮显隐、前端路由保护</strong>，本质上都是围绕这串权限点做判断。</p>
<hr>
<h2 id="2-权限点命名模块--资源--动作">2. 权限点命名：模块 + 资源 + 动作</h2>
<p>命名如果乱，后面就会非常难维护。实践中我会用统一格式：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>&lt;模块&gt;:&lt;资源&gt;:&lt;动作&gt;
</span></span></code></pre></div><p>例如：</p>
<ul>
<li><code>order:list:view</code> —— 订单列表查看；</li>
<li><code>order:list:export</code> —— 订单列表导出；</li>
<li><code>order:detail:update</code> —— 订单详情修改；</li>
<li><code>user:manage:create</code> —— 用户管理新增。</li>
</ul>
<p>在数据库或配置里，用一个简单的结构描述：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Permission</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">code</span>: <span style="color:#66d9ef">string</span>;      <span style="color:#75715e">// order:list:view
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">name</span>: <span style="color:#66d9ef">string</span>;      <span style="color:#75715e">// 订单列表-查看
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">description?</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>前端拿到的就是一串 <code>code</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[<span style="color:#e6db74">&#34;order:list:view&#34;</span>, <span style="color:#e6db74">&#34;order:list:export&#34;</span>, <span style="color:#e6db74">&#34;order:detail:update&#34;</span>]
</span></span></code></pre></div><hr>
<h2 id="3-菜单与路由根据权限生成">3. 菜单与路由：根据权限生成</h2>
<h3 id="31-菜单数据从后端来">3.1 菜单数据从后端来</h3>
<p>让后端维护一份菜单树：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">MenuItem</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">id</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">parentId?</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">title</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">path</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">icon?</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 访问该菜单需要的权限点（可以是单个或多个）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">permission?</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">children?</span>: <span style="color:#66d9ef">MenuItem</span>[];
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>登录成功后，前端请求：</p></div><div class="post-footer">
        <a href="/posts/2021-04-02-permission-system-design/">阅读全文</a><div class="post-tags">
                <i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/%E6%9D%83%E9%99%90%E7%B3%BB%E7%BB%9F/">权限系统</a>,&nbsp;<a href="/tags/rbac/">RBAC</a>,&nbsp;<a href="/tags/%E5%89%8D%E7%AB%AF%E6%9D%83%E9%99%90/">前端权限</a></div></div>
</article><article class="single summary" itemscope itemtype="http://schema.org/Article"><h1 class="single-title" itemprop="name headline">
        <a href="/posts/2021-01-23-multi-end-code-sharing/">一次代码，多端运行：H5 + 小程序的复用实践</a>
    </h1><div class="post-meta"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>wuwj</a></span>&nbsp;<span class="post-publish">发布于 <time datetime="2021-01-23">2021-01-23</time></span>&nbsp;<span class="post-category">收录于 <a href="/categories/%E5%A4%9A%E7%AB%AF%E5%BC%80%E5%8F%91/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>多端开发</a></span></div><div class="content"><p>多端已经是老话题了：</p>
<ul>
<li>产品想要 <strong>H5 + 小程序 + 后面可能再来个 App</strong>；</li>
<li>但人手并不会随平台数量线性增加。</li>
</ul>
<p>所以问题就变成了：</p>
<blockquote>
<p><strong>能不能尽量做到：一套业务逻辑，多端复用，只在各端做少量适配？</strong></p>
</blockquote>
<p>这篇文章从一个实际项目出发，聊聊我是怎么拆分层次、抽象业务核心、隔离端能力差异，让 H5 和小程序在同一套代码下运行得比较舒服。</p>
<hr>
<h2 id="1-能复用和不能复用的先分清">1. 能复用和不能复用的先分清</h2>
<p>先别谈框架，先想清楚几件事：</p>
<p><strong>通常可以复用的：</strong></p>
<ul>
<li>业务模型：订单、用户、商品这些核心数据结构；</li>
<li>领域逻辑：状态流转、金额计算、表单校验等纯逻辑；</li>
<li>接口层：请求参数组装、响应数据提取、错误码处理；</li>
<li>公共工具：日期、金额、校验、格式化等。</li>
</ul>
<p><strong>通常不能直接复用的：</strong></p>
<ul>
<li>UI 组件和布局（DOM vs 小程序组件）；</li>
<li>路由与页面生命周期；</li>
<li>存储层（<code>localStorage</code> vs <code>wx.setStorage</code> 等）；</li>
<li>原生能力（扫码、相册、位置等）。</li>
</ul>
<p>所以设计时的目标是：</p>
<blockquote>
<p><strong>把「业务核心」从这些平台差异里剥离出来，用一层「适配器」去对接不同端能力。</strong></p>
</blockquote>
<hr>
<h2 id="2-目录与分层core--adapters">2. 目录与分层：core + adapters</h2>
<p>我们当时的多端项目采用的是类似 Monorepo 的结构：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>project-root
</span></span><span style="display:flex;"><span>├── packages
</span></span><span style="display:flex;"><span>│   ├── core          <span style="color:#75715e"># 端无关的业务核心（可被多端复用）</span>
</span></span><span style="display:flex;"><span>│   ├── h5            <span style="color:#75715e"># H5 端工程（Vue/React 等）</span>
</span></span><span style="display:flex;"><span>│   └── miniapp       <span style="color:#75715e"># 小程序端工程（uni-app / Taro / 原生）</span>
</span></span><span style="display:flex;"><span>└── package.json
</span></span></code></pre></div><h3 id="21-core-里放什么">2.1 <code>core</code> 里放什么？</h3>
<p>核心模块大致有：</p>
<ul>
<li><code>models/</code> —— 订单、用户等类型定义和基础逻辑；</li>
<li><code>services/</code> —— 业务服务，比如下单、取消订单、查询列表；</li>
<li><code>apis/</code> —— 针对后端的 API 封装（不依赖具体请求实现）；</li>
<li><code>utils/</code> —— 工具方法。</li>
</ul>
<p>关键点是：<strong><code>core</code> 不能直接用浏览器 API 或小程序 API</strong>，一旦用了就失去可复用性。</p></div><div class="post-footer">
        <a href="/posts/2021-01-23-multi-end-code-sharing/">阅读全文</a><div class="post-tags">
                <i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/%E4%BB%A3%E7%A0%81%E5%A4%8D%E7%94%A8/">代码复用</a>,&nbsp;<a href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/">小程序</a>,&nbsp;<a href="/tags/h5/">H5</a>,&nbsp;<a href="/tags/%E5%A4%9A%E7%AB%AF%E6%9E%B6%E6%9E%84/">多端架构</a></div></div>
</article><ul class="pagination"><li class="page-item ">
                    <span class="page-link">
                        <a href="/">1</a>
                    </span>
                </li><li class="page-item ">
                    <span class="page-link" aria-hidden="true">&hellip;</span>
                </li><li class="page-item ">
                    <span class="page-link">
                        <a href="/page/4/">4</a>
                    </span>
                </li><li class="page-item ">
                    <span class="page-link">
                        <a href="/page/5/">5</a>
                    </span>
                </li><li class="page-item active">
                    <span class="page-link">
                        <a href="/page/6/">6</a>
                    </span>
                </li><li class="page-item ">
                    <span class="page-link">
                        <a href="/page/7/">7</a>
                    </span>
                </li><li class="page-item ">
                    <span class="page-link">
                        <a href="/page/8/">8</a>
                    </span>
                </li></ul></div></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.152.2">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.3.0"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">wuwj</a></span>&nbsp;|&nbsp;<span class="license">CC BY-NC 4.0</span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/typeit/index.umd.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":50},"data":{"id-1":"A quiet place to keep a record of things."},"search":{"highlightTag":"em","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":30},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
