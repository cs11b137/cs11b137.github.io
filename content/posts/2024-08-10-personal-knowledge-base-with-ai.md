+++
title = "用 Hugo + 向量库搭一个个人知识库 + AI 搜索"
date = 2024-08-10
draft = false
categories = ["个人建设", "AI 应用"]
tags = ["Hugo", "知识库", "RAG", "向量检索"]
description = "把博客和笔记喂给向量库，再接上大模型，做一套只服务于自己的知识库 + AI 搜索，让写过的东西真正「用得上」。"
+++

写博客、记笔记时间久了，经常会有这种感觉：

> 某个问题我好像以前写过，但完全想不起来写在哪里了。

传统搜索要么靠关键词，要么翻目录，其实挺费劲。  
于是干脆做了一件事：

> 把 Hugo 博客里的文章当成「知识库」，用向量检索 + 大模型搭一个自己的 AI 搜索。

下面简单记录一下从 0 到 1 的过程。

---

## 1. 数据来源：直接用 Hugo 的 Markdown

因为网站本身就是 Hugo，所以数据天然在本地：

- `content/posts/**/*.md`：原始文章  
- Front matter 里有标题、日期、标签等信息

相比解析生成后的 HTML，我更倾向直接读 Markdown：

- 结构简单  
- 不用做 HTML 清洗  
- 标题、层级天然存在

简单写个脚本：

1. 遍历 `content/posts`  
2. 解析 front matter（用现成库即可）  
3. 拿到正文内容

---

## 2. 文档切分：从文章到「片段」

RAG 的关键是切分策略。  
我采用了一个折中方案：

1. 按二级/三级标题做初步分段（`##` / `###`）  
2. 每一段如果太长，再按字数（比如 300～500 字）切成多个片段

每个片段保存的信息大致是：

```jsonc
{
  "id": "2023-09-10-rag-for-project-docs#section-3-1",
  "postSlug": "2023-09-10-rag-for-project-docs",
  "title": "用 RAG 做项目文档问答：从零搭一个 Demo",
  "date": "2023-09-10",
  "sectionPath": ["3. 向量化：Embedding 与向量库"],
  "content": "……这一小段的正文……",
  "tags": ["RAG", "向量检索"]
}
```

这些 metadata 会用于后续结果展示和过滤。

---

## 3. 向量化与存储

### 3.1 向量化

选择一个适合中文的 Embedding 模型即可，方式比较标准：

```ts
const embedding = await embed(chunk.content)
// embedding: number[]
```

然后把向量和 metadata 一起入库。

### 3.2 向量库

个人项目对 QPS 要求不高，可以选轻量方案：

- SQLite + 向量扩展  
- 或者一个简单的云向量服务

只要支持：

- 写入：`(vector, metadata)`  
- 查询：给定向量，返回最相近的 K 个片段

就足够用了。

---

## 4. 查询流程：从问题到答案

以后我要找东西时，在一个简单页面里输入问题，比如：

> 「我之前是怎么做 Monorepo 迁移的？」

后台流程：

1. 对这个问题做 Embedding  
2. 在向量库中检索 Top K 相似片段  
3. 把这些片段 + 原问题，发给大模型  
4. 让模型基于片段内容回答，顺带给出引用

Prompt 会强调：

> 只允许根据提供的片段内容回答问题；  
> 如果片段里没有出现相关信息，就回答「好像没有明确记录过这部分细节」。

这样可以最大程度减少瞎编。

---

## 5. 前端界面：简单但实用

界面非常朴素：

- 上面一个输入框 + 「发送」按钮  
- 中间是对话记录区  
- 侧边展示这次命中的文章列表（标题、时间、标签）

交互细节：

- 回答支持 Markdown 渲染，方便展示代码块  
- 点击某个引用可以在新页面打开对应文章  
- 可以加一个「只在某年 / 某标签内搜索」的筛选

因为只给自己用，所以 UI 不需要太复杂，主要是顺手。

---

## 6. 与 Hugo 构建集成：写完文章自动入库

为了省事，把索引更新接到构建流程里：

1. 写完文章，push 到仓库  
2. CI 里先跑 `hugo` 生成网站  
3. 构建完成后，跑一个「更新知识库」脚本：  
   - 扫描新增或改动的 Markdown  
   - 做切分 + 向量化  
   - 更新向量库里的记录

这样「写博客 → 网站更新 → 知识库更新」是一条链路，不用手动维护。

---

## 7. 使用体验：它帮我解决了什么？

大概有三点：

1. **找回「老想法」变得很快**  
   - 想不起来几年前对某个技术的看法，搜一句就能出来  
   - 对比现在的思路，也很好玩

2. **写新东西前可以扫一眼历史记录**  
   - 避免重复写完全一样的内容  
   - 也能看到自己之前踩过的坑

3. **更有动力写长文**  
   - 因为知道它们不会「写完就算」  
   - 未来随时可以被检索出来继续复用

---

## 8. 小结

这套 Hugo + 向量库 + AI 搜索的组合，其实并不复杂：

1. 利用现有博客 / 笔记当知识库  
2. 设计简洁的切分策略和 Embedding 流程  
3. 用向量检索找到相关片段，再让大模型帮忙整理成答案  
4. 搞一个顺手的小前端界面  
5. 在构建流程里自动更新索引

它让写作变成了一个「持续给自己增加知识资产」的过程，  
而不是把文章丢在角落里吃灰。

如果你自己也有一堆博客/笔记，很推荐做一套类似的东西：  
**不是为了做产品，而是为了让「写过的东西」真正服务未来的自己。**
